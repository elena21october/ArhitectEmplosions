@model Models.HazarNabeg.HazarNabeg

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <style>
        .alert {
            padding: 15px;
            border: 1px solid #d6e9c6;
            border-radius: 4px;
            color: #3c763d;
            background-color: #dff0d8;
        }
    </style>
    <title>Быстрый старт. Размещение интерактивной карты на странице</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="https://api-maps.yandex.ru/2.1/?apikey=d5e25ddd-0718-4acb-a851-ff855eddb60d&lang=ru_RU" type="text/javascript"> </script>
</head>
<body>
    <h1 id="Hazar">ХазАРХский набег</h1>
    <input type ="button" id="addDiv" value="1"/>
    <input type ="button" id="lookDiv" value="2"/>
    <div id="addVar">
        <div style="display:flex; justify-content: space-between; border:solid; border-color:blueviolet">
            <div style="width:400px; display:flex; flex-direction:column; font-size: 13px; border:solid; border-color:green">
                <div style=" width:200px; display:flex; flex-direction:column;">
                    <h3>Пол</h3>
                    <div>
                        <p><input type="radio" name="Pol" checked />Муж </p>
                        <p><input type="radio" name="Pol" />Жен</p>
                    </div>
                </div>

                <div style="display:flex; flex-direction:column; ">
                    <h3>Где вы живете?</h3>
                    <p><input type="radio" name="life" checked  />В общежитии</p>
                    <p><input type="radio" name="life" />Район Черниковка</p>
                    <p><input type="radio" name="life" />В другой части города</p>
                    <p><input type="radio" name="life" />За городом </p>
                    <p><input type="radio" name="life" />В другом городе </p>
                </div>

                <div style=" display:flex; flex-direction:column; ">
                    <h3>Вы посещаете кампус как:</h3>
                    <p><input type="radio" name="Diff" />Студент-бакалавр</p>
                    <p><input type="radio" name="Diff" />Студент-Магистр</p>
                    <p><input type="radio" name="Diff" />Студент-аспирант</p>
                    <p><input type="radio" name="Diff" />Преподаватель</p>
                    <p><input type="radio" name="Diff" />Сотрудник ВУЗа</p>
                    <p><input type="radio" name="Diff" />Гость</p>
                    <p><input type="radio" name="Diff" />Партнер ВУЗа</p>
                    <p><input type="radio" name="Diff" />Горожанин</p>
                </div>

                <div style=" display:flex; flex-direction:column;">
                    <h3>Возраст</h3>
                    <p><input type="radio" name="Age" />14-17</p>
                    <p><input type="radio" name="Age" />18-24</p>
                    <p><input type="radio" name="Age" />25-35</p>
                    <p><input type="radio" name="Age" />36-45</p>
                    <p><input type="radio" name="Age" />46-60</p>
                    <p><input type="radio" name="Age" />61-74</p>
                    <p><input type="radio" name="emot" />75 и более</p>
                </div>
            </div>
        <div id="map" style="width: 1200px; height: 957px; border:solid; border-color:green"></div>
            <div style="display:flex; flex-direction:column; border:solid; border-color:green">
                <div>
		            <h2>Комментарии к положительным эмоциям</h2>
		            <textarea id="comment" name="comment" placeholder="Написать комментарий" cols="30" rows="7"></textarea>
                    <h2>Комментарии к отрицательным эмоциям</h2>
		            <textarea id="comment" name="comment" placeholder="Написать комментарий" cols="30" rows="7"></textarea>
                    <h2>Комментарии к нейтральным эмоциям</h2>
		            <textarea id="comment" name="comment" placeholder="Написать комментарий" cols="30" rows="7"></textarea>
                </div>
                <div>
		            <h2>Добавить эмоцию</h2>
                    <input type="radio" name="emot" value="#9300FF8F" checked />Положительная<br>
                    <input type="radio" name="emot" value="#FF00008F" />Отрицательная<br>
                    <input type="radio" name="emot" value="#FFF200AB" />Нейтральная<br>
                    <button id="createQuest">Создать анкету</button><br>
                    <button id="createPolygon">Создать эмоцию</button><br>
                    <input type="button" value="Завершить редактирование" id="stopEditPolyline"/> <br>
                    <button id="sendBtn">Отправить</button>
                </div>
	        </div>
	    </div>
    </div>
    <div style="display:none" id="pushVar">
        <div style="display:flex; justify-content:flex-end;  border:solid; border-color:green">
            <div id = "quests" style="width:600px; height: 957px; border:solid; border-color:green">
            </div>
            <div style="width:600px; height: 957px; border:solid; border-color:blue">
                <div id="mapLook" style="width: 1200px; height: 957px; border:solid; border-color:orange"></div>
            </div>
        </div>
    </div>
        <script>
            //classes for quest
            class Point 
            {
                X;
                Y;
            }
            class Emotion 
            { 
                Color;
                Points;
                constructor() { 
                    this.Points = [];
                }
            }
            class Questionnaire {
                Id;
                Emotions;
                PositiveComm;
                NegativeComm;
                NeutralComm;
                constructor() {
                    this.Emotions = new Set();
                }
            }
            var questionnaires = document.getElementById("quests");
            var listQuest = [];
            var quest = new Questionnaire();
            ymaps.ready(initAdd);
        
        function del(ii) {

            var rm = document.getElementById(ii);
            console.log("удалить" + rm);
            rm.remove();
        }
        document.getElementById("sendBtn").addEventListener("click", function () {
            console.log(listQuest);
            console.log(quest);
        });
            function initAdd() 
            {
                var myMap = new ymaps.Map("map",
                {
                    center: [54.817693719811864, 56.060026019052515],
                    zoom: 15

                });
                document.getElementById("createPolygon").addEventListener("click", createPolygon);
                
                function createPolygon() 
                {
                    var emotion = new Emotion();
                    var radiobuttons = document.getElementsByName("emot");
                    for (var i = 0; i < radiobuttons.length; i++) 
                    {
                        if (radiobuttons[i].checked == true) 
                        {
                            emotion.Color = radiobuttons[i].value;
                            break;
                        }
                    }
                    polygon = new ymaps.Polygon([], {},
                    {
                        editorDrawingCursor: "crosshair",
                        editorMaxPoints: 5,
                        fillColor: emotion.Color,
                        strokeColor: emotion.Color,
                        strokeWidth: 5
                    });
                    myMap.geoObjects.add(polygon);
                    polygon.editor.startDrawing();

                    $('input').attr('disabled', false);

                    $('#stopEditPolyline').click(function (){
                        $('#stopEditPolyline').attr('disabled', true);
                        polygon.editor.stopEditing();
                        var coord = polygon.geometry.getCoordinates();

                        var point1 = new Point();
                        point1.X = coord[0][0][0];
                        point1.Y = coord[0][0][1];

                        var point2 = new Point();
                        point2.X = coord[0][1][0];
                        point2.Y = coord[0][1][1];

                        var point3 = new Point();
                        point3.X = coord[0][2][0];
                        point3.Y = coord[0][2][1];

                        var point4 = new Point();
                        point4.X = coord[0][3][0];
                        point4.Y = coord[0][3][1];
                        if (emotion.Points.length != 4) { 
                            emotion.Points.push(point1);
                            emotion.Points.push(point2);
                            emotion.Points.push(point3);
                            emotion.Points.push(point4);                        
                        }
                        quest.Emotions.add(emotion);
                        $('stopEditPolyline').attr('disabled', false);
                    });
                }
                    document.getElementById("createQuest").addEventListener("click", function () {
                        listQuest.push(quest);
                        console.log(listQuest);
                        quest = new Questionnaire();
                        myMap.geoObjects.removeAll();
                    });
            }

            ymaps.ready(initLook)
            function initLook()
            {
                var lookMap = new ymaps.Map("mapLook",
                {
                    center: [54.76896962314046, 56.02959755460908],
                    zoom: 15
                });
            document.getElementById("addDiv").addEventListener("click", function () {
                var add = document.getElementById("addVar");
                var push = document.getElementById("pushVar");
                push.setAttribute("style", "display:none");
                add.setAttribute("style", "");
            });

            document.getElementById("lookDiv").addEventListener("click", function () {
                var add = document.getElementById("addVar");
                var push = document.getElementById("pushVar");
                add.setAttribute("style", "display:none");
                push.setAttribute("style", "");
                console.log(listQuest);
                for (var i = 0; i < listQuest.length; i++) {
                    let div = document.createElement('div');
                    div.className = "alert";
                    div.innerHTML = "<strong>Всем привет! " + i + " </strong> Вы прочитали важное сообщение.";
                    div.setAttribute("id", "look" + i);
                    let btn = document.createElement('button');
                    btn.setAttribute("id", "del" + i);
                    div.appendChild(btn);
                    questionnaires.appendChild(div);
                    document.getElementById("look" + i).addEventListener("click", () => func(div.id));
                    document.getElementById("del" + i).addEventListener("click", () => del(div.id));
                }
            });
                function func(pp) 
                {
                    var index = pp.slice(4);
                    var item = listQuest[pp.slice(4)];
                    console.log("index");
                    console.log(item);
                    lookMap.geoObjects.removeAll();
                    for (n of item.Emotions) { 
                        var polygon = new ymaps.Polygon(
                            [[
                                [n.Points[0].X, n.Points[0].Y],
                                [n.Points[1].X, n.Points[1].Y],
                                [n.Points[2].X, n.Points[2].Y],
                                [n.Points[3].X, n.Points[3].Y],
                            ]], {},
                            {
                                editorMaxPoints: 5,
                                // Цвет заливки.
                                fillColor: n.Color,
                                // Цвет обводки.
                                strokeColor: n.Color,
                                // Ширина обводки.
                                strokeWidth: 5

                            });
                            lookMap.geoObjects.add(polygon);
                    }

                }
            }

            
            
        </script>
    </body>
</html>